<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CRIB Storage</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <h1 id="title">CRIB</h1>

    <fieldset>
        <legend>Insert an item</legend>
        <input type="text" id="inputKey" placeholder="Enter item...">
        <input type="text" id="inputValue" placeholder="Enter location...">
        <button id="btnInsert" type=button">Add item</button>
    </fieldset>

    <fieldset>
            <legend>Where did I put it?</legend>
            <input type="text" id="searchItem" placeholder="Search for an item...">
            <button id="btnSearch" type=button">Search</button>
            <div id="itemIsHere"></div>

    </fieldset>

    <fieldset>
            <legend>Local storage</legend>
            <div id="isOutout"></div>
            <button id="btnClear" type=button">ClearLocalStorage</button>
        </fieldset>

    <script>
        const inputKey = document.getElementById("inputKey");
        const inputValue = document.getElementById("inputValue");
        const btnInsert = document.getElementById("btnInsert");
        const isOutout = document.getElementById("isOutout");
        const searchItem = document.getElementById("searchItem");
        const btnSearch = document.getElementById("btnSearch");

        btnInsert.onclick = function() {

            let key = inputKey.value;
            let value = inputValue.value;

            if (key == "" || value == "") {
                alert ("Dobby says: \nPlease enter something other than spaces!");
            }
            else {
                if (localStorage.getItem(key) !== null) {
                    alert ("Dobby says: \n item is already in CRIB!");
                }
                else {
                    localStorage.setItem(key, value);
                    location.reload();
                    inputKey.value = "";
                    inputValue.value = "";
            }}
        };

        for (let l=0; l< localStorage.length; l++) {
            let storedKey = localStorage.key(l);
            let storedValue = localStorage.getItem(storedKey);

            isOutout.innerHTML += `${storedKey}: ${storedValue}<br /> `;
        }
        
        btnSearch.onclick = function() {

            function getLocation(query) {
                var i, results = [];
                for (i in localStorage) {
                    if (localStorage.hasOwnProperty(i)) {
                    if (i.toLowerCase().match(query.toLowerCase()) || (!query && typeof i === 'string')) {
                        value = localStorage.getItem(i);
                        results.push({key:i,val:value});
                    }
                    }
                }
                return results;
            }

            let itemToSearch = searchItem.value;
            if (itemToSearch == "") {
                alert ("Dobby says: \nPlease enter something other than spaces!");
            }
            else {
                let resultLocation = getLocation(itemToSearch);
                if (resultLocation.length == 0) {
                    alert ("Dobby says: \nDafuq? item is not in CRIB!");
                    searchItem.value = "";
                    itemIsHere.innerHTML = "";
                }
                else {
                    itemIsHere = document.getElementById("itemIsHere");
                    let locations = '';
                    if (resultLocation.length > 1) {
                        itemIsHere.innerHTML = "";
                        for (let ind = 0; ind < resultLocation.length; ind++){
                            locations = resultLocation[ind].val;
                            itemIsHere.innerHTML += searchItem.value + " is in location:" + locations + "<br>";                        }
                    }
                    else {
                        locations = resultLocation[0].val;
                        itemIsHere.innerHTML = searchItem.value + " is in location:" + locations;
                    }
                    searchItem.value = "";}
                }
            // } 
        };

        btnClear.onclick = function() {
            localStorage.clear();
            isOutout.innerHTML = "";
        };
        


//TODO
//         dropdown cu camere, apoi in functie de selectie => display all locations or add new one. Mai bine lucruri predefinite => 3 items de locatie
//         tabel cu filtrare si sortare
//         change location
//         add save in json
        // trim spaces
        // optional - search almost: with other chars ";"
        // CRUD (delete)



    </script>
</body>
</html>